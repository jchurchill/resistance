<% # All javascripts for all widget types must be included on the page before this may be included. %>

<% # Even though we're in an html.erb, this is all javascript that is expected      %>
<% # to be placed inside a javascript_tag. Note that it must be escaped with raw(). %>
var JJ = { widgets: {} };

<% # Create all widget instances being used on the page. %>
<% dependency_ordered_widget_instances.each do | w | %>
<% # Store the widget instance in JJ.widgets hash by its id, attach it to its div. %>
JJ.widgets["<%= w[:widget_uuid] %>"] = $(".<%= w[:widget_box_class] %>")["<%= w[:widget_type] %>"](
	<% # Each widget instance gets populated with a set of options: %>
	<% # 1. the widget data passed into the widget %>
	<%= raw widget_instance_data_options_object(w[:widget_uuid], 'JJ.widgets').to_json %>
	<% # 2. all child widget instances for this widget (which has already been created due to dependency ordering) %>
).data("<%= w[:widget_data_name] %>");
<% end %>